â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    GUÃA DE IMPLEMENTACIÃ“N MULTI-TENANT                   â•‘
â•‘                            Sistema FUDDO                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ REQUISITOS PREVIOS:
- XAMPP instalado y funcionando
- Tu BD actual 'fuddo' funcionando correctamente
- Acceso a phpMyAdmin o lÃ­nea de comandos MySQL

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: CREAR BASE DE DATOS MAESTRA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1.1 Abre phpMyAdmin: http://localhost/phpmyadmin

1.2 Ejecuta el archivo SQL:
    - Ve a la pestaÃ±a "SQL"
    - Abre: c:\xampp\htdocs\fuddo\sql\01_crear_bd_maestra.sql
    - Copia TODO el contenido
    - PÃ©galo en phpMyAdmin
    - Click en "Continuar"

1.3 Verifica que se creÃ³:
    - DeberÃ­as ver la BD "fuddo_master" en el panel izquierdo
    - Con 2 tablas: restaurantes, usuarios_master
    - Con 1 registro en cada tabla

âœ“ RESULTADO: BD maestra creada con:
   - Restaurante "Restaurante Principal" (usa tu BD actual 'fuddo')
   - Usuario super-admin: admin / password

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 2: GENERAR CONTRASEÃ‘A PERSONALIZADA (OPCIONAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2.1 Si quieres cambiar la contraseÃ±a del super-admin:
    
    Visita: http://localhost/fuddo/generar_password.php
    
2.2 Ingresa tu contraseÃ±a deseada â†’ Click "Generar Hash"

2.3 Copia el hash generado

2.4 En phpMyAdmin, ejecuta:
    
    USE fuddo_master;
    UPDATE usuarios_master 
    SET password = 'PEGA_AQUI_EL_HASH' 
    WHERE usuario = 'admin';

âœ“ RESULTADO: ContraseÃ±a personalizada configurada

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 3: EXPORTAR ESQUEMA DE TU BD ACTUAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

3.1 Visita: http://localhost/fuddo/exportar_esquema.php

3.2 Verifica que diga: "âœ“ Esquema exportado exitosamente"

3.3 Verifica que existe: c:\xampp\htdocs\fuddo\sql\schema_restaurante.sql

âœ“ RESULTADO: Archivo schema_restaurante.sql generado (plantilla para nuevos restaurantes)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 4: HACER BACKUP DE ARCHIVOS ORIGINALES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

4.1 Abre PowerShell en: c:\xampp\htdocs\fuddo

4.2 Ejecuta:
    .\backup_archivos.ps1

    O manualmente:
    Copy-Item validar.php validar_original_backup.php
    Copy-Item includes\conexion.php includes\conexion_original_backup.php

âœ“ RESULTADO: Backups creados por seguridad

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 5: ACTUALIZAR SISTEMA DE VALIDACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5.1 Renombrar validar.php actual:
    validar.php â†’ validar_old.php

5.2 Renombrar el nuevo validador:
    validar_multitenant.php â†’ validar.php

5.3 O simplemente ejecuta en PowerShell:
    
    Move-Item validar.php validar_old.php -Force
    Move-Item validar_multitenant.php validar.php -Force

âœ“ RESULTADO: Sistema de login multi-tenant activo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 6: ACTUALIZAR CONEXIÃ“N A BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

6.1 Edita: includes\conexion.php

6.2 REEMPLAZA TODO EL CONTENIDO con:

<?php
/**
 * ConexiÃ³n dinÃ¡mica a la base de datos del restaurante
 * Se conecta a la BD especÃ­fica segÃºn el restaurante del usuario
 */

if (!defined('DB_HOST')) define('DB_HOST', 'localhost');
if (!defined('DB_USER')) define('DB_USER', 'root');
if (!defined('DB_PASS')) define('DB_PASS', '');

// Iniciar sesiÃ³n si no estÃ¡ iniciada
if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

// Obtener nombre de BD desde la sesiÃ³n
if (!isset($_SESSION['nombre_bd'])) {
    // Si no hay BD en sesiÃ³n, usar la BD por defecto
    // Esto permite que login.php funcione antes de autenticaciÃ³n
    $DB_NAME = 'fuddo'; // Tu BD principal
} else {
    $DB_NAME = $_SESSION['nombre_bd'];
}

if (!defined('DB_NAME')) define('DB_NAME', $DB_NAME);

// Crear conexiÃ³n solo si no existe
if (!isset($conexion)) {
    $conexion = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

    // Verificar conexiÃ³n
    if ($conexion->connect_error) {
        die("Error de conexiÃ³n: " . $conexion->connect_error);
    }

    // Configurar charset y zona horaria
    $conexion->set_charset("utf8mb4");
    $conexion->query("SET time_zone = '-05:00'"); // Colombia
}
?>

6.3 Guarda el archivo

âœ“ RESULTADO: ConexiÃ³n dinÃ¡mica configurada

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 7: SINCRONIZAR USUARIO EN BD LOCAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

7.1 Abre phpMyAdmin â†’ BD "fuddo" â†’ Tabla "usuarios"

7.2 Verifica que exista un usuario "admin" con rol "fuddo-admin"

7.3 Si NO existe, ejecuta:

    USE fuddo;
    
    INSERT INTO usuarios (usuario, password, nombre, email, rol, estado) 
    VALUES (
        'admin',
        '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi',
        'Administrador FUDDO',
        'admin@fuddo.co',
        'fuddo-admin',
        'activo'
    );

7.4 IMPORTANTE: El usuario y password deben coincidir con usuarios_master

âœ“ RESULTADO: Usuario sincronizado en ambas BDs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 8: PROBAR EL SISTEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

8.1 Cierra todas las sesiones:
    - Visita: http://localhost/fuddo/logout.php

8.2 Abre el login:
    - Visita: http://localhost/fuddo/login.php

8.3 Inicia sesiÃ³n con:
    Usuario: admin
    Password: password (o la que configuraste)

8.4 DeberÃ­as ver:
    âœ“ Dashboard de FUDDO funcionando normalmente
    âœ“ En la sesiÃ³n estÃ¡ guardado 'nombre_bd' => 'fuddo'
    âœ“ Todos los mÃ³dulos funcionan (mesas, productos, usuarios)

âœ“ RESULTADO: Sistema multi-tenant funcionando con tu BD actual

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 9: CREAR UN SEGUNDO RESTAURANTE (PRUEBA)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

9.1 Inicia sesiÃ³n como super-admin (admin)

9.2 Visita: http://localhost/fuddo/crear_restaurante.php

9.3 Completa el formulario:
    
    DATOS DEL RESTAURANTE:
    - Nombre: PizzerÃ­a Italia
    - Identificador: pizzeria01 (sin espacios, solo letras/nÃºmeros)
    - Contacto: Juan PÃ©rez
    - Email: pizzeria@ejemplo.com
    - TelÃ©fono: 123456789
    
    USUARIO ADMINISTRADOR:
    - Usuario: admin_pizzeria
    - ContraseÃ±a: 123456
    - Nombre Completo: Administrador PizzerÃ­a
    - Email: admin@pizzeria.com

9.4 Click en "Crear Restaurante"

9.5 DeberÃ­a aparecer:
    "Restaurante creado exitosamente"
    "BD: fuddo_pizzeria01"

9.6 Verifica en phpMyAdmin:
    âœ“ Nueva BD "fuddo_pizzeria01" creada
    âœ“ Con todas las tablas (mesas, productos, servicios, usuarios)
    âœ“ Con datos de ejemplo

âœ“ RESULTADO: Segundo restaurante creado

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 10: PROBAR ACCESO AL SEGUNDO RESTAURANTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

10.1 Cierra sesiÃ³n: http://localhost/fuddo/logout.php

10.2 Inicia sesiÃ³n con el nuevo usuario:
     Usuario: admin_pizzeria
     Password: 123456

10.3 DeberÃ­as ver:
     âœ“ Dashboard de FUDDO
     âœ“ SOLO los datos de "PizzerÃ­a Italia"
     âœ“ NO ves datos del "Restaurante Principal"

10.4 Verifica la sesiÃ³n:
     $_SESSION['nombre_bd'] = 'fuddo_pizzeria01'
     $_SESSION['nombre_restaurante'] = 'PizzerÃ­a Italia'

âœ“ RESULTADO: Aislamiento total entre restaurantes confirmado

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‰ IMPLEMENTACIÃ“N COMPLETADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VERIFICACIÃ“N FINAL:
â˜‘ BD maestra creada (fuddo_master)
â˜‘ Sistema de login multi-tenant activo
â˜‘ ConexiÃ³n dinÃ¡mica funcionando
â˜‘ Primer restaurante usando BD actual (fuddo)
â˜‘ Segundo restaurante con BD separada (fuddo_pizzeria01)
â˜‘ Cada usuario ve solo SUS datos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š ARCHIVOS IMPORTANTES:

CONEXIONES:
- includes/conexion_master.php     â†’ ConexiÃ³n a BD maestra
- includes/conexion_dinamica.php   â†’ ConexiÃ³n dinÃ¡mica (NO SE USA DIRECTAMENTE)
- includes/conexion.php            â†’ MODIFICADO para usar sesiÃ³n

AUTENTICACIÃ“N:
- validar.php                      â†’ Login multi-tenant (RENOMBRADO de validar_multitenant.php)
- validar_old.php                  â†’ Login original (BACKUP)

GESTIÃ“N:
- crear_restaurante.php            â†’ Crear nuevos restaurantes (solo super-admin)
- exportar_esquema.php             â†’ Exportar estructura de BD
- generar_password.php             â†’ Generar hashes de contraseÃ±as

SQL:
- sql/01_crear_bd_maestra.sql     â†’ Script de instalaciÃ³n
- sql/schema_restaurante.sql       â†’ Plantilla para nuevos restaurantes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ SOLUCIÃ“N DE PROBLEMAS:

PROBLEMA: "Error de conexiÃ³n a BD maestra"
SOLUCIÃ“N: Verifica que fuddo_master existe en phpMyAdmin

PROBLEMA: "Usuario no encontrado"
SOLUCIÃ“N: Verifica que el usuario existe en usuarios_master Y en la tabla usuarios de su BD

PROBLEMA: "BD no existe"
SOLUCIÃ“N: Verifica que nombre_bd en tabla restaurantes coincide con BD real

PROBLEMA: Login no funciona
SOLUCIÃ“N: 
1. Verifica que validar_multitenant.php se renombrÃ³ a validar.php
2. Verifica que usuario/password son correctos
3. Revisa errores en login.php?error=XXXX

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ SIGUIENTE PASO RECOMENDADO:

Actualizar url.php para que detecte todas las subcarpetas automÃ¡ticamente
o usar rutas absolutas con BASE_URL en todo el sistema.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
